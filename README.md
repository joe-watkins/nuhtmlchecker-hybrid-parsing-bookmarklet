# NU HTML Checker Hybrid Parsing Bookmarklet
Hybrid bookmarklet to run after validating markup using the [Nu HTML Checker](https://validator.w3.org/nu/about.html) to check for WCAG `4.1.1 Parsing` conformance.

## How to use
- Drag the following link: <a href="javascript:(function()%7Bvar%20removeNg%20%3D%20true%3B%0A%20%20%20%20var%20killWarnings%20%3D%20true%3B%0A%20%20%20%20var%20filterStrings%20%3D%20%5B%22tag%20seen%22%2C%20%22Stray%20end%20tag%22%2C%20%22Bad%20start%20tag%22%2C%20%22Duplicate%20ID%22%2C%20%22first%20occurrence%20of%20ID%22%2C%20%22Unclosed%20element%22%2C%20%22unclosed%20elements%22%2C%20%22unquoted%20attribute%20value%22%2C%20%22Duplicate%20attribute%22%5D%3B%0A%20%20%20%20var%20validationStrings%20%3D%20%5B%22violates%20nesting%20rules%22%2C%20%22not%20allowed%20as%20child%20of%20element%22%2C%20%20%22not%20allowed%20on%20element%22%5D%3B%0A%20%20%20%20var%20filterRE%2C%20validationRE%2C%20root%2C%20results%2C%20result%2C%20resultText%2C%20i%2C%20cnt%20%3D%200%3B%0A%20%20%20%20filterRE%20%3D%20filterStrings.join(%22%7C%22)%3B%0A%20%20%20%20validationRE%20%3D%20validationStrings.join(%22%7C%22)%3B%0A%20%20%20%20root%20%3D%20document.getElementById(%22results%22)%3B%0A%20%20%20%20if%20(!root)%20%7B%0A%20%20%20%20%20%20%20%20alert(%22No%20results%20container%20found.%22)%3B%0A%20%20%20%20%20%20%20%20return%0A%20%20%20%20%7D%0A%20%20%20%20results%20%3D%20root.getElementsByTagName(%22li%22)%3B%0A%20%20%20%20for%20(i%20%3D%200%3B%20i%20%3C%20results.length%3B%20i%20%2B%3D%201)%20%7B%0A%20%20%20%20%20%20%20%20result%20%3D%20results%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20if(killWarnings%20%26%26%20result.className.indexOf(%22info%20warning%22)%20!%3D%3D%20-1)%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20result.style.display%20%3D%20%22none%22%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20if%20(result.className%20!%3D%3D%20%22%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20resultText%20%3D%20(result.innerText%20!%3D%3D%20undefined%20%3F%20result.innerText%20%3A%20result.textContent)%20%2B%20%22%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(resultText.match(filterRE)%20%3D%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.style.display%20%3D%20%22none%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.className%20%3D%20result.className%20%2B%20%22%20parsingIssues%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cnt%20%2B%3D%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20if%20(removeNg%20%3D%3D%20true)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20(resultText.indexOf(%22not%20allowed%20on%20element%22)%20!%3D%3D%20-1%20%26%26%20resultText.indexOf(%22ng-%22)%20!%3D%3D%20-1%20%26%26%20resultText.indexOf(%22ng-%22)%20%3C%20resultText.indexOf(%22not%20allowed%20on%20element%22))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.style.display%20%3D%20%22none%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.className%20%3D%20result.className%20%2B%20%22%20removeAngular%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cnt%20%2B%3D%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(resultText.match(validationRE)%20!%3D%3D%20null)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.style.background%20%3D%20%22%23fffaa0%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.style.display%20%3D%20%22block%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20var%20currentMarkup%20%3D%20result.innerHTML%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.innerHTML%20%3D%20currentMarkup%20%2B%20%22%3Cdiv%20style%3D'background%3A%20aliceblue%3B%20padding%3A%201em%3B%20border%3A%20dashed%202px%20%23000%3B%20margin-top%3A%201em%3B%20font-size%3A120%25%3B'%3E%3Cstrong%3ENot%20a%20WCAG%204.1.1%20Parsing%20failure%20%2F%20Validation%20Issue%3A%3C%2Fstrong%3E%20While%20not%20technically%20a%20pure%20violation%20of%20WCAG%204.1.1%20Parsing%2C%20consider%20fixing%20this%20issue%20for%20maximum%20compatibility%20with%20assistive%20technology.%20Learn%20More%3A%20%3Ca%20href%3D'https%3A%2F%2Fcstrobbe.gitlab.io%2FA11yWorks%2Fwcagtests%2Fhtml5%2Fsc_4.1.1_syntax%2Findex.html'%3EUnderstanding%20and%20Testing%20WCAG%202.1%20Success%20Criterion%204.1.1%3C%2Fa%3E%20%7C%20%3Ca%20href%3D'https%3A%2F%2Fgithub.com%2Fw3c%2Fwcag%2Fissues%2F2525'%3EProposal%20to%20Rephrase%20Success%20Criterion%204.1.1%3C%2Fa%3E%3C%2Fdiv%3E%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20result.className%20%3D%20result.className%20%2B%20%22%20validationIssue%22%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20alert(%22Complete.%20%22%20%2B%20cnt%20%2B%20%22%20items%20updated.%22)%7D)()%3B">NU HTML Checker Hybrid Parsing Bookmarklet</a> to your bookmarks. Or, manually create a bookmark using [this JavaScript](https://raw.githubusercontent.com/joe-watkins/nuhtmlchecker-hybrid-parsing-bookmarklet/main/nuhtmlchecker-parsing-bookmarklet.js) as the `URL`.
- Run the [Check serialized DOM of current page](https://validator.w3.org/nu/about.html) bookmarklet to validate the page. Or, use the "Send selected DOM" button in the [ARC Toolkit](https://www.tpgi.com/arc-platform/arc-toolkit/) to send the DOM to the validator.
- Then run the Nu HTML Checker Hybrid bookmarklet by clicking on it in your bookmarks to see the results.
- Issues that are not pure WCAG `4.1.1 Parsing` issues are removed.
- Issues that may not be hard WCAG `4.1.1 Parsing` issues but should be considered for fixing will be identified as "Not a WCAG 4.1.1 Parsing failure / Validation Issue: ..."

![Screenshot of issue that is not a WCAG 4.1.1 Failure marked as Not a WCAG 4.1.1 Parsing failure / Validation Issue](https://user-images.githubusercontent.com/3695795/192630728-1ade6959-2282-4cb4-9e0f-f2c9011bd49b.png)

## Background
There are currently two schools of thought with regards to testing for conformance to WCAG `4.1.1 Parsing` after running the [Nu Html Checker](https://validator.w3.org/nu/). 

- [Check for WCAG 2.0 parsing compliance bookmarklet - Steve Faulkner](https://validator.w3.org/nu/about.html) [validation type issues remain e.g. content model]
- [WCAG Syntax Only Bookmarklet - Christophe Strobbe](https://cstrobbe.gitlab.io/A11yWorks/wcagtests/html5/sc_4.1.1_syntax/wcag-syntax-bookmarklet.html) [removes all validation type issues leaving pure syntax-style issues]

I've combined these two approaches so that only true WCAG `4.1.1` failures are presented, but issues that are not hard failures and are worth consideration of fixing are still present in the results and clearly marked as such.

## Learn More
- [Understanding and Testing WCAG 2.1 Success Criterion 4.1.1](https://cstrobbe.gitlab.io/A11yWorks/wcagtests/html5/sc_4.1.1_syntax/index.html)
- [Proposal to Rephrase Success Criterion 4.1.1 #2525](https://github.com/w3c/wcag/issues/2525)


## Thank you
- Thank you to Steve Faulkner for his contributions to the web and the code this was based on. [wcagparsing](https://github.com/stevefaulkner/wcagparsing)
- Thank you to Christophe Strobbe who helped us understand what true `4.1.1 Parsing` conformance is and what some of this code is based on. [WCAG Syntax Only Bookmarklet - Christophe Strobbe](https://cstrobbe.gitlab.io/A11yWorks/wcagtests/html5/sc_4.1.1_syntax/wcag-syntax-bookmarklet.html)